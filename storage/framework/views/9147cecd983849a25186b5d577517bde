<?php $__env->startSection('content'); ?>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

<div class="kt-body kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor kt-grid--stretch" id="kt_body">
	<div class="kt-content kt-content--fit-top  kt-grid__item kt-grid__item--fluid kt-grid kt-grid--hor" id="kt_content">

		<!-- begin:: Subheader -->
		<div class="kt-subheader   kt-grid__item" id="kt_subheader">
			<div class="kt-container ">
				<div class="kt-subheader__main">
					<h3 class="kt-subheader__title">
						<?php echo trans("messages.invoice_generate.invoice"); ?></h3>
					<div class="kt-subheader__breadcrumbs">
						<a href="<?php echo WEBSITE_URL; ?>" class="kt-subheader__breadcrumbs-home"><i class="flaticon2-shelter"></i></a>
						<span class="kt-subheader__breadcrumbs-separator"></span>
						<span class="kt-subheader__breadcrumbs-link">
							 <?php echo trans("messages.invoice_generate.infoq"); ?></span>
						<span class="kt-subheader__breadcrumbs-separator"></span>
						<a href="" class="kt-subheader__breadcrumbs-link">
							<?php echo !empty($subProjectDetails) ? $subProjectDetails->project_name:'';; ?> </a>
						<span class="kt-subheader__breadcrumbs-separator"></span>
						<a href="" class="kt-subheader__breadcrumbs-link">
							<?php echo !empty($subProjectDetails) ? $subProjectDetails->sub_project_name:'';; ?> </a>
						<span class="kt-subheader__breadcrumbs-separator"></span>
						<a href="#" class="kt-subheader__breadcrumbs-link">
							<?php echo trans("messages.invoice_generate.invoice"); ?></a>
					</div>
				</div>
			</div>
		</div>

		<!-- end:: Subheader -->

		<!-- begin:: Content -->
		<div class="kt-container  kt-grid__item kt-grid__item--fluid">
			<div class="kt-portlet">
				<div class="kt-portlet__body kt-portlet__body--fit">
					<div class="kt-invoice-2">
						<div class="kt-invoice__head">
							<div class="kt-invoice__container">
								<div class="kt-invoice__brand">
									<h1 class="kt-invoice__title"><?php echo trans("messages.invoice_generate.invoice"); ?></h1>
									<div href="<?php echo WEBSITE_URL; ?>" class="kt-invoice__logo" >
										<?php
											if(!empty(Config::get("Settings.logo")) && File::exists(SYSTEM_IMAGE_DIRECTROY_PATH . Config::get("Settings.logo"))){
												$logo = SYSTEM_IMAGE_URL . Config::get("Settings.logo");
											}else{
												$logo = WEBSITE_IMG_URL . "logo.png";
											}
										?>
										<a href="<?php echo WEBSITE_URL; ?>" style="margin: auto;"><img src="<?php echo $logo; ?>" style=" width: 150px;"></a>
										<span class="kt-invoice__desc">
											<span><?php echo Config::get("Settings.business_address"); ?></span>
										</span>
									</div>
								</div>
								<div class="kt-invoice__items">
									<div class="kt-invoice__item">
										<span class="kt-invoice__subtitle"><?php echo trans("messages.invoice_generate.invoice_date"); ?></span>
										<span class="kt-invoice__text"><?php echo date("M d,Y",strtotime($orderDetails->created_at)); ?></span>
									</div>
									<div class="kt-invoice__item">
										<span class="kt-invoice__subtitle"><?php echo trans("messages.invoice_generate.invoice_no"); ?></span>
										<span class="kt-invoice__text"><?php echo $orderDetails->bill_id; ?></span>
									</div>
									<div class="kt-invoice__item">
										<span class="kt-invoice__subtitle"><?php echo trans("messages.invoice_generate.invoice_to"); ?></span>
										<span class="kt-invoice__text"><?php echo $orderDetails->full_name; ?>,<br><?php echo $orderDetails->address; ?></span>
									</div>
								</div>

								<div class="kt-invoice__items">
									<div class="kt-invoice__item">
										<span class="kt-invoice__subtitle"><?php echo trans("messages.book_plan.payment_options"); ?></span>
										<span class="kt-invoice__text"><?php echo $orderDetails->payment_method_name; ?></span>
									</div>
									<div class="kt-invoice__item">
										<span class="kt-invoice__subtitle"><?php echo trans("messages.book_plan.reference_id"); ?></span>
										<span class="kt-invoice__text"><?php echo $orderDetails->refrence_id; ?></span>
									</div>
									<div class="kt-invoice__item">
										<span class="kt-invoice__subtitle"><?php echo trans("messages.book_plan.payment_type"); ?></span>
										<span class="kt-invoice__text">
											<?php if($orderDetails->payment_type == 1): ?>
												<?php echo trans("messages.book_plan.recuring"); ?>

											<?php else: ?>
												<?php echo trans("messages.book_plan.one_time_payment"); ?>

											<?php endif; ?>
										</span>
									</div>
									
									<?php $paymentPending = ""; ?>
									<div class="kt-invoice__item">
										<span class="kt-invoice__subtitle"> <?php echo trans("messages.book_plan.payment_status"); ?> </span>
										<?php if(!empty($paymentInvoice)): ?>
										  <?php if($paymentInvoice->payment_status == 1): ?>
											<button class="btn btn-warning" style="width: 100%"><?php echo trans("messages.book_plan.waiting_approval"); ?></button>
										  <?php elseif($paymentInvoice->payment_status == 2): ?>
											<?php if($paymentInvoice->payment_option == 1 || $paymentInvoice->payment_option == 5): ?>
												<button class="btn btn-success" style="width: 100%"><?php echo trans("messages.book_plan.auto_approve"); ?></button>
											<?php else: ?>
												<button class="btn btn-success" style="width: 100%"><?php echo trans("messages.book_plan.success"); ?></button>
											<?php endif; ?>	
										  <?php elseif($paymentInvoice->payment_status == 3): ?>
											<button class="btn btn-warning" style="width: 100%"><?php echo trans("messages.book_plan.pending"); ?></button>
											<?php $paymentPending = "1"; ?>
										  <?php elseif($paymentInvoice->payment_status == 4): ?>
											<button class="btn btn-danger" style="width: 100%"><?php echo trans("messages.book_plan.reject"); ?></button>
										  <?php elseif($paymentInvoice->payment_status == 5): ?>
											<button class="btn btn-info" style="width: 100%"><?php echo trans("messages.book_plan.expired"); ?></button>
										  <?php else: ?>
											<button class="btn btn-warning" style="width: 100%"><?php echo trans("messages.book_plan.pending"); ?></button> 
											<?php $paymentPending = "1"; ?>
										  <?php endif; ?>
										<?php else: ?>
											<button class="btn btn-warning" style="width: 100%"><?php echo trans("messages.book_plan.pending"); ?></button>
											<?php $paymentPending = "1"; ?>
										<?php endif; ?>
									</div>
								</div>
							</div>
						</div>
						<div class="kt-invoice__body">
							<div class="kt-invoice__container">
								<div class="table-responsive">
									<table class="table">
									 <?php if($subProjectDetails->project_module == 1): ?>
										<thead>
											<tr>
												<th><?php echo trans("messages.invoice_generate.description"); ?></th>
												<th>
													<?php if($orderDetails->plan_type == "yearly"): ?>
														<?php echo trans("messages.invoice_generate.years"); ?>

													<?php elseif($orderDetails->plan_type == "monthly"): ?>
														<?php echo trans("messages.invoice_generate.months"); ?>

													<?php else: ?>
														<?php echo trans("messages.invoice_generate.days"); ?>

													<?php endif; ?>
												</th>
												<th><?php echo trans("messages.invoice_generate.amount"); ?></th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td><?php echo trans("messages.book_plan.plan"); ?> <?php echo CURRENCY.$planPrice; ?> <?php echo !empty($orderDetails->other_plan_price)? "(other)":"";; ?></td>
												<td><?php echo $planPeriod; ?></td>
												<td class="kt-font-danger kt-font-lg"><?php echo CURRENCY.$planPrice; ?></td>
											</tr>
										</tbody>
									 <?php elseif($subProjectDetails->project_module == 2): ?>
										<thead>
											<tr>
												<th><?php echo trans("messages.invoice_generate.description"); ?></th>
												<?php if($subProjectDetails->customize_plan_option == 2 || $subProjectDetails->customize_plan_option == 4): ?>
													<th><?php echo trans("messages.invoice_generate.unit"); ?></th>
												<?php elseif($subProjectDetails->customize_plan_option == 3): ?>
													<th><?php echo trans("messages.sub_project_detail.quantity"); ?></th>
												<?php endif; ?>
												<th><?php echo trans("messages.invoice_generate.amount"); ?></th>
											</tr>
										</thead>
										<tbody>
											<?php if($subProjectDetails->customize_plan_option == 2): ?>
												<?php if(!empty($orderDetails->planDescription)): ?>
												  <?php foreach($orderDetails->planDescription as $planDescription): ?>
													<tr>
														<td><?php echo $subProjectDetails->seat_reservation_main_title; ?> - <?php echo $planDescription->seat_name; ?> - <?php echo $planDescription->total_attendance; ?> Attend</td>
														<td><?php echo $planDescription->total_seat; ?></td>
														<td class="kt-font-danger kt-font-lg"><?php echo CURRENCY; ?> <?php echo $planDescription->total_seat * $planDescription->amount; ?></td>
													</tr>
												  <?php endforeach; ?>
												<?php endif; ?>
												<tr>
													<td><?php echo $subProjectDetails->seat_reservation_main_title_2; ?></td>
													<td>1</td>
													<td class="kt-font-danger kt-font-lg"><?php echo CURRENCY; ?> <?php echo !empty($orderDetails->seat_reservation_plan_price_2)?$orderDetails->seat_reservation_plan_price_2:0; ?></td>
												</tr>
											<?php elseif($subProjectDetails->customize_plan_option == 3): ?>
												<tr>
													<td><?php echo trans("messages.book_plan.plan"); ?> <?php echo $planName; ?></td>
													<td><?php echo $orderDetails->quantity; ?></td>
													<td class="kt-font-danger kt-font-lg"><?php echo CURRENCY; ?> 
													  <?php if(!empty($paymentInvoice->amount)): ?>
														<?php echo $paymentInvoice->amount; ?> 
													  <?php else: ?>
														<?php echo !empty($planPrice) ? ($planPrice + $orderDetails->total_contribution) : $orderDetails->total_contribution;; ?>

													  <?php endif; ?>
													</td>
												</tr>
											<?php elseif($subProjectDetails->customize_plan_option == 4): ?>
												<?php if(!empty($orderDetails->planDescription)): ?>
												  <?php foreach($orderDetails->planDescription as $planDescription): ?>
													<tr>
														<td><?php echo $planDescription->name; ?> - <?php echo $planDescription->plan_name; ?></td>
														<td>1</td>
														<td class="kt-font-danger kt-font-lg"><?php echo CURRENCY; ?> 
														  <?php echo $planDescription->price; ?>

														</td>
													</tr>
												  <?php endforeach; ?>
												<?php endif; ?>
											<?php else: ?>
												<tr>
													<td><?php echo trans("messages.book_plan.plan"); ?> <?php echo $planName; ?></td>
													<td class="kt-font-danger kt-font-lg"><?php echo CURRENCY; ?> <?php echo !empty($planPrice) ? ($planPrice + $orderDetails->total_contribution) : $orderDetails->total_contribution;; ?></td>
												</tr>
											<?php endif; ?>
										</tbody>
									 <?php elseif($subProjectDetails->project_module == 3): ?>
										<thead>
											<tr>
												<th><?php echo trans("messages.invoice_generate.description"); ?></th>
												<?php if($subProjectDetails->customize_plan_option == 6): ?>
													<th><?php echo trans("messages.invoice_generate.vendor"); ?></th>
												<?php endif; ?>
												<th><?php echo trans("messages.invoice_generate.unit"); ?></th>
												<th><?php echo trans("messages.invoice_generate.amount"); ?></th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td><?php echo $planName; ?></td>
												<?php if($subProjectDetails->customize_plan_option == 6): ?>
													<td><?php echo !empty($subProjectDetails->vendor_name)?$subProjectDetails->vendor_name:''; ?></td>
												<?php endif; ?>
												<td>1</td>
												<td class="kt-font-danger kt-font-lg"><?php echo CURRENCY.$orderDetails->total_contribution; ?></td>
											</tr>
										</tbody>
									 <?php endif; ?>
									</table>
									<table class="table" style="background-color:#f9f9f9">
										<tbody>
											<tr>
												<td>Total Amount</td>
												<td class="kt-font-danger kt-font-lg">
													<?php if(!empty($paymentInvoice->amount)): ?>
														<?php echo CURRENCY." ".$paymentInvoice->amount; ?> 
													<?php else: ?> 
														<?php echo CURRENCY." ".$orderDetails->total_contribution; ?>

													<?php endif; ?>
												</td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
						<?php if($subProjectDetails->project_module == 1): ?>
						<div class="kt-invoice__footer">
							<div class="kt-invoice__container">
								<div class="table-responsive">
									<table class="table">
										<thead>
											<tr>
												<th><?php echo trans("messages.invoice_generate.commitment_type"); ?></th>
												<th><?php echo trans("messages.invoice_generate.period"); ?></th>
												<th><?php echo trans("messages.invoice_generate.end_date"); ?></th>
												<th><?php echo trans("messages.book_plan.total_amount"); ?></th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td><?php echo ucfirst($orderDetails->plan_type); ?></td>
												<td>
													<?php echo $planPeriod; ?> 
													<?php if($orderDetails->plan_type == "yearly"): ?>
														<?php echo trans("messages.invoice_generate.years"); ?>

														<?php $periodType = "years"; ?>
													<?php elseif($orderDetails->plan_type == "monthly"): ?>
														<?php echo trans("messages.invoice_generate.months"); ?>

														<?php $periodType = "months"; ?>
													<?php else: ?>
														<?php echo trans("messages.invoice_generate.days"); ?>

														<?php $periodType = "days"; ?>
													<?php endif; ?>
												</td>
												<td><?php echo date("M d,Y",strtotime("+ ".$planPeriod." ".$periodType,strtotime($orderDetails->created_at))); ?></td>
												<td class="kt-font-danger kt-font-xl kt-font-boldest"><?php echo CURRENCY.$planPrice; ?></td>
											</tr>
										</tbody>
									</table>
								</div>
							</div>
						</div>
						<?php endif; ?>
						<div class="kt-invoice__actions">
							<div class="kt-invoice__container">
								<button type="button" class="btn btn-label-brand btn-bold" onclick="window.print();"><?php echo trans("messages.invoice_generate.download_invoice"); ?></button>
								<?php if(!empty(Auth::user())): ?>
									<button type="button" class="btn btn-label-success btn-bold btn_1" onclick="location.href='<?php echo URL('/dashboard'); ?>';"><?php echo trans("messages.header.go_to_dashboard"); ?></button>
								<?php else: ?>
								  <button type="button" class="btn btn-label-success btn-bold btn_1 openSignupModel"><?php echo trans("messages.header.go_to_dashboard"); ?></button>
								<?php endif; ?>
								<?php if($paymentPending == 1): ?>
									<button type="button" class="btn btn-brand btn-bold btn_1 order_final_payment" data-order-id="<?php echo $orderDetails->id; ?>" data-toggle="modal" data-target="#kt_modal_payment_form"><?php echo trans("messages.invoice_generate.make_payment"); ?></button>
								<?php else: ?>
								<button type="button" class="btn btn-danger btn-bold" onclick="window.print();"><?php echo trans("messages.invoice_generate.print_invoice"); ?></button>
								<?php endif; ?>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- end:: Content -->
	</div>
</div>



<div id="kt_modal_payment_form" class="modal fade" role="dialog" aria-hidden="true">
	<div class="modal-dialog modal-xl">
		<div class="modal-content" style="min-height: 590px;">
			
			<div class="order_payment_data"></div>
			
		</div>
	</div>
</div>


<?php 
	$PaymentMethod = Session::get('PaymentMethod'); 
	if(!empty($PaymentMethod)){ ?>
		<script>
			$( document ).ready(function() {
				$(".order_final_payment").trigger("click");
			})
		</script>
<?php
	}
?>

<script>
$(".order_final_payment").click(function(){
	var OrderId = "<?php echo $orderDetails->id; ?>";
	var PaymentId = "<?php echo $paymentInvoice->id; ?>";
	$('#loader_img').show();
	$.ajax({
		url: '<?php echo route("User.GetFinalPaymentDetails"); ?>',
		type:'POST',
		data: {'OrderId':OrderId,'PaymentId':PaymentId},
		success: function(response){
			$('#loader_img').hide();
			$(".order_payment_data").html(response);
		},
		error: function(r){
			$('#loader_img').hide();
		},
	});
	
})

</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.2/jspdf.min.js"></script>

<script>
function onClick() {
  var pdf = new jsPDF('p', 'pt', 'letter');
  pdf.canvas.height = 72 * 11;
  pdf.canvas.width = 72 * 8.5;

  pdf.fromHTML(document.body);

  pdf.save('test.pdf');
};

var element = document.getElementById("clickbind");
element.addEventListener("click", onClick);
</script>

<?php $__env->stopSection(); ?>
<?php echo $__env->make('front.layouts.default', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>